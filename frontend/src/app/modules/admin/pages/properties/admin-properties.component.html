<div class="admin-properties-container">
    <div class="header">
        <h1>System Properties</h1>
        <p>Monitor all listings and moderate property visibility across the platform.</p>
    </div>

    <div *ngIf="loading" class="loading-wrapper">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Loading property index...</p>
    </div>

    <div class="table-container mat-elevation-z4" *ngIf="!loading">
        <table mat-table [dataSource]="properties">

            <!-- Property Title Column -->
            <ng-container matColumnDef="title">
                <th mat-header-cell *matHeaderCellDef>Property</th>
                <td mat-cell *matCellDef="let p">
                    <div class="property-info">
                        <span class="property-title">{{ p.title }}</span>
                        <span class="property-rent">â‚¹{{ p.rent }} / mo</span>
                    </div>
                </td>
            </ng-container>

            <!-- Location Column -->
            <ng-container matColumnDef="location">
                <th mat-header-cell *matHeaderCellDef>Location</th>
                <td mat-cell *matCellDef="let p">
                    <div class="location-cell">
                        <mat-icon>location_on</mat-icon>
                        <span>{{ p.location }}</span>
                    </div>
                </td>
            </ng-container>

            <!-- Owner Column -->
            <ng-container matColumnDef="owner">
                <th mat-header-cell *matHeaderCellDef>Owner</th>
                <td mat-cell *matCellDef="let p">
                    <div class="owner-cell">
                        <span class="owner-name">{{ p.owner?.name }}</span>
                        <span class="owner-email">{{ p.owner?.email }}</span>
                    </div>
                </td>
            </ng-container>

            <!-- Status Column -->
            <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let p">
                    <mat-chip [ngClass]="p.isActive ? 'active-chip' : 'blocked-chip'" selected>
                        {{ p.isActive ? 'Active' : 'Blocked' }}
                    </mat-chip>
                </td>
            </ng-container>

            <!-- Action Column -->
            <ng-container matColumnDef="action">
                <th mat-header-cell *matHeaderCellDef>Action</th>
                <td mat-cell *matCellDef="let p">
                    <button mat-flat-button [color]="p.isActive ? 'warn' : 'primary'" (click)="toggleStatus(p)"
                        class="action-btn">
                        <mat-icon>{{ p.isActive ? 'block' : 'check_circle' }}</mat-icon>
                        {{ p.isActive ? 'Block' : 'Activate' }}
                    </button>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

            <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell" colspan="5">No properties found in the system.</td>
            </tr>
        </table>
    </div>
</div>